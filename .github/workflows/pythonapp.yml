name: Python application

on: [push]

jobs:
#    build:
#        runs-on: ubuntu-latest
#        strategy:
#            max-parallel: 4
#            matrix:
#                python-version: [3.8, 3.7, 3.6]
#        steps:
#        - uses: actions/checkout@v1
#        - name: 'Set up Python ${{ matrix.python-version }}'
#            uses: actions/setup-python@v1
#            with:
#                python-version: '${{ matrix.python-version }}'
#
#        - name: 'Install dependencies'
#            env:
#                PIPENV_NOSPIN: 1
#            run: |
#                python -m pip install --upgrade pipenv
#                pipenv sync --dev
#
#        - name: 'Lint with flake8'
#            run: |
#                # stop the build if there are Python syntax errors or undefined names
#                pipenv run flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
#                # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
#                pipenv run flake8 . --count --exit-zero --max-complexity=10 --statistics
#
#        - name: 'Run pytest'
#            env:
#                PYTHONPATH: src
#            run: |
#                pipenv run pytest

    compile:
        runs-on: ubuntu-latest
        strategy:
            max-parallel: 4
            matrix:
                python-version: [3.8, 3.7, 3.6]
        steps:
        - name: 'compile micropython'
            env:
                MAKEOPTS="-j4"
            run: |
                sudo -E apt-get -qq update
                sudo -E apt-get -qq install build-essential git-core
                git clone --depth=5 https://github.com/micropython/micropython.git
                wget https://github.com/jepler/esp-open-sdk/releases/download/2018-06-10/xtensa-lx106-elf-standalone.tar.gz
                zcat xtensa-lx106-elf-standalone.tar.gz | tar x
                export PATH=$(pwd)/xtensa-lx106-elf/bin:$PATH
                make ${MAKEOPTS} -C mpy-cross
                make ${MAKEOPTS} -C ports/esp8266 submodules
                make ${MAKEOPTS} -C ports/esp8266
                make ${MAKEOPTS} -C ports/esp8266 BOARD=GENERIC_512K
